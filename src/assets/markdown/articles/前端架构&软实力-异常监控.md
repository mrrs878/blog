---
title: å‰ç«¯æ¶æ„&è½¯å®åŠ›-å¼‚å¸¸ç›‘æ§
date: 2020-06-08 22:33:01
tags: å¼‚å¸¸ç›‘æ§
categories: å‰ç«¯æ¶æ„/è½¯å®åŠ›
---

# JavaScriptä¸­çš„å¼‚å¸¸å¤„ç†æ–¹å¼

å¯¹äºJavaScriptè€Œè¨€ï¼Œæˆ‘ä»¬é¢å¯¹çš„ä»…ä»…åªæ˜¯å¼‚å¸¸ï¼Œå¼‚å¸¸çš„å‡ºç°å¹¶ä¸ä¼šç›´æ¥å¯¼è‡´JavaScriptå¼•æ“å´©æºƒï¼Œæœ€å¤šåªä¼šä½¿å½“å‰æ‰§è¡Œçš„ä»»åŠ¡ç»ˆæ­¢

1. å½“å‰ä»£ç å—å°†ä½œä¸ºä¸€ä¸ªä»»åŠ¡å‹å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼ŒJavaScriptå¼•æ“çº¿ç¨‹ä¼šä¸æ–­åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æå–ä»»åŠ¡æ‰§è¡Œ
2. å½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¸”å¼‚å¸¸æ²¡æœ‰æ•è·å¤„ç†ï¼Œåˆ™ä¼šä¸€ç›´æ²¿ç€è°ƒç”¨æ ˆä¸€å±‚å±‚å‘å¤–æŠ›å‡ºï¼Œæœ€ç»ˆç»ˆæ­¢å½“å‰ä»»åŠ¡åœ°æ‰§è¡Œ
3. JavaScriptå¼•æ“çº¿ç¨‹ç»§ç»­ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡ç»§ç»­æ‰§è¡Œ

å¼‚å¸¸ä¸»è¦åˆ†ä¸ºä¸¤å¤§ä¸­ï¼š**è¿è¡Œæ—¶é”™è¯¯**å’Œè¯­**æ³•é”™è¯¯**ã€‚è¯­æ³•é”™è¯¯åœ¨ç¼–å†™ä»£ç æœŸé—´å¾ˆå®¹æ˜“è¢«å‘ç°ï¼Œè¿è¡Œæ—¶é”™è¯¯ä¸»è¦ç”±å–å€¼/èµ‹å€¼å¼‚å¸¸ã€å‡½æ•°æ‰§è¡Œå‡ºé”™ç­‰

# å¦‚ä½•æ•è·å¼‚å¸¸

## æ•è·æ™®é€šJavaScriptå¼‚å¸¸

å¯¹äºæ™®é€šçš„JavaScriptå¼‚å¸¸ï¼Œå¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨`try-catch`è¿›è¡ŒåŒ…è£¹ï¼Œå½“`try`ä¸­çš„ä»£ç å—æ‰§è¡Œå‡ºé”™åï¼Œ`catch`å°†èƒ½æ•æ‰åˆ°å¼‚å¸¸ï¼Œä»£ç ä¹Ÿå¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»

ä½†`try-catch`å¤„ç†å¼‚å¸¸çš„èƒ½åŠ›æœ‰é™ï¼Œ**åªèƒ½æ•æ‰åˆ°è¿è¡Œæ—¶éå¼‚æ­¥é”™è¯¯**ï¼Œå¯¹äºè¯­æ³•é”™è¯¯å’Œå¼‚æ­¥é”™è¯¯å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œæ•æ‰ä¸åˆ°

## æ•è·å¼‚æ­¥JavaScriptå¼‚å¸¸

`window.onerror`æ•è·å¼‚å¸¸èƒ½åŠ›æ¯”`try-catch`ç¨å¾®å¼ºç‚¹ï¼Œæ— è®ºæ˜¯å¼‚æ­¥è¿˜æ˜¯éå¼‚æ­¥è¿è¡Œæ—¶é”™è¯¯ï¼Œ`onerror`éƒ½èƒ½æ•è·åˆ°

``` js
window.onerror = function (msg, url, row, col, error) {
  console.log('æˆ‘çŸ¥é“é”™è¯¯äº†');
  console.log({
    msg,  url,  row, col, error
  })
  return true;
};
```

ä½¿ç”¨æ³¨æ„ï¼š

- åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ`windows.onerror` ä¸»è¦æ˜¯æ¥æ•è·é¢„æ–™ä¹‹å¤–çš„é”™è¯¯ï¼Œè€Œ `try-catch` åˆ™æ˜¯ç”¨æ¥åœ¨å¯é¢„è§æƒ…å†µä¸‹ç›‘æ§ç‰¹å®šçš„é”™è¯¯ï¼Œä¸¤è€…ç»“åˆä½¿ç”¨æ›´åŠ é«˜æ•ˆã€‚
- `window.onerror` å‡½æ•°åªæœ‰åœ¨è¿”å› true çš„æ—¶å€™ï¼Œå¼‚å¸¸æ‰ä¸ä¼šå‘ä¸ŠæŠ›å‡ºï¼Œå¦åˆ™å³ä½¿æ˜¯çŸ¥é“å¼‚å¸¸çš„å‘ç”Ÿæ§åˆ¶å°è¿˜æ˜¯ä¼šæ˜¾ç¤º
- `window.onerror`æ— æ³•æ•è·åˆ°ç½‘ç»œå¼‚å¸¸çš„é”™è¯¯
- æ— æ³•æ•è·`Promise`å¼‚å¸¸

## æ•è·**Promise** å¼‚å¸¸

é€šè¿‡ `Promise` å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¼‚æ­¥å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦ ~å®ä¾‹æŠ›å‡ºå¼‚å¸¸è€Œä½ æ²¡æœ‰ç”¨ `catch` å»æ•è·çš„è¯ï¼Œ`onerror` æˆ– `try-catch` ä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼Œæ— æ³•æ•æ‰åˆ°é”™è¯¯

å¯¹æ­¤å¯ä»¥æ·»åŠ ä¸€ä¸ª **`Promise` å…¨å±€å¼‚å¸¸æ•è·äº‹ä»¶** `unhandledrejection`

```js
window.addEventListener("unhandledrejection", function(e){
  e.preventDefault()
  console.log('æˆ‘çŸ¥é“ promise çš„é”™è¯¯äº†');
  console.log(e.reason);
  return true;
});
```

|                    | åŒæ­¥æ–¹æ³• | å¼‚æ­¥æ–¹æ³• | èµ„æºåŠ è½½ | Promise | async/await |
| ------------------ | -------- | -------- | -------- | ------- | ----------- |
| try/catch          | ğŸ‘Œ        |          |          |         | ğŸ‘Œ           |
| `onerror`          | ğŸ‘Œ        | `ğŸ‘Œ`      |          |         |             |
| error Handler      | ğŸ‘Œ        | ğŸ‘Œ        | ğŸ‘Œ        |         |             |
| unhandledrejection |          |          |          | ğŸ‘Œ       | ğŸ‘Œ           |

## æ•è·Vue.js/React.jsç­‰é¡¹ç›®ä¸­çš„å¼‚å¸¸

- Vue.js

  ```js
  Vue.config.errorHandler = (err, vm, info) => {
      console.log('error: ', err)
  }
  ```

- React.js

  è‡ªå®šä¹‰ErrorBoundaryç»„ä»¶

## å®é™…é¡¹ç›®è¿ç”¨

å†™ä¸€ä¸ªwebpackæ’ä»¶å…¨å±€åŠ«æŒ`console.error`

# ä¸ŠæŠ¥å¼‚å¸¸

- å¼‚æ­¥è¯·æ±‚ä¸ŠæŠ¥, åç«¯æä¾›æ¥å£ï¼Œæˆ–è€…ç›´æ¥å‘åˆ°æ—¥å¿—æœåŠ¡å™¨
- imgè¯·æ±‚ä¸ŠæŠ¥, urlå‚æ•°å¸¦ä¸Šé”™è¯¯ä¿¡æ¯
  - eg:(new Image()).src = 'https://xxx'

å‚è€ƒï¼š

[ä»0åˆ°1ï¼ŒVueå¤§ç‰›çš„å‰ç«¯æ­å»ºâ€”â€”å¼‚å¸¸ç›‘æ§ç³»ç»Ÿ](https://zhuanlan.zhihu.com/p/142418902)

[å‰ç«¯å¼‚å¸¸ç›‘æ§](https://juejin.im/post/5b53218cf265da0f9313a3de)